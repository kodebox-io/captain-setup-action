name: "Setup"
inputs:
  cache-venv:
    default: false
  cache-yarn:
    default: false
runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup Python 3.11
      id: setup-python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"
        architecture: "x64"
        cache: "pipenv"

    - name: Setup Pipenv
      shell: bash
      run: |
        pip install pipenv
        python --version ; pip --version ; pipenv --version

    - name: zz deps_django
      if: inputs.cache-venv == 'true' && steps.setup-python.outputs.cache-hit != 'true'
      shell: bash
      run: |
        ./zz deps_django

    - name: Setup Node 14
      uses: actions/setup-node@v3
      with:
        node-version: "14"
        cache: "yarn"

    - name: Run Yarn Install
      if: inputs.cache-yarn == 'true'
      shell: bash
      run: yarn install

    - name: Initialize Lerna
      if: steps.cache-yarn.outputs.cache-hit == 'true'
      shell: bash
      run: |
        yarn lerna bootstrap
        yarn lerna exec --parallel yarn link
