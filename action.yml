name: "Setup"
inputs:
  cache-venv:
    default: false
  cache-yarn:
    default: false
runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: Setup Python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: "3.8"
        architecture: "x64"

    - name: Setup Pipenv
      uses: dschep/install-pipenv-action@v1
      with:
        version: 2021.5.29 # https://github.com/pypa/pipenv/issues/4833

    - name: Cache .venv
      if: ${{ inputs.cache-venv }}
      uses: actions/cache@v2
      id: cache-venv
      env:
        cache-name: cache-venv
      with:
        path: ./.venv
        key: v1-${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('**/Pipfile.lock') }}-${{ github.event.number }}
        restore-keys: |
          ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/Pipfile.lock') }}-
          ${{ runner.os }}-build-${{ env.cache-name }}-
          ${{ runner.os }}-build-
          ${{ runner.os }}-

    - name: Setup Node 14
      uses: actions/setup-node@v2
      with:
        node-version: "14"

    - name: Set YARN_CACHE_DIR
      if: ${{ inputs.cache-yarn }}
      shell: bash
      run: echo "YARN_CACHE_DIR=$(yarn cache dir)" >> $GITHUB_ENV

    - name: Cache yarn
      if: ${{ inputs.cache-yarn }}
      uses: actions/cache@v2
      id: cache-yarn
      env:
        cache-name: cache-yarn
      with:
        path: env.YARN_CACHE_DIR
        key: v1-${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('**/yarn.lock') }}-${{ github.event.number }}
        restore-keys: |
          ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('**/yarn.lock') }}-
          ${{ runner.os }}-${{ env.cache-name }}-
          ${{ runner.os }}-
